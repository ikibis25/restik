(function(e){"use strict";e.fn.waterwheelCarousel=function(t){function s(){i={itemsContainer:e(n),totalItems:e(n).find("img").length,containerWidth:e(n).width(),containerHeight:e(n).height(),currentCenterItem:null,previousCenterItem:null,items:[],calculations:[],carouselRotationsLeft:0,currentlyMoving:false,itemsAnimating:0,currentSpeed:r.speed,intervalTimer:null,currentDirection:"forward",leftItemsCount:0,rightItemsCount:0,performingSetup:true};i.itemsContainer.find("img").removeClass(r.activeClassName)}function o(e){clearTimeout(i.autoPlayTimer);if(!e&&r.autoPlay!==0){i.autoPlayTimer=setTimeout(function(){if(r.autoPlay>0){b("forward")}else{b("backward")}},Math.abs(r.autoPlay))}}function u(t){if(r.preloadImages===false){t();return}var n=i.itemsContainer.find("img"),s=0,o=n.length;n.each(function(){e(this).bind("load",function(){s+=1;if(s===o){t();return}});e(this).attr("src",e(this).attr("src"));if(this.complete){e(this).trigger("load")}})}function a(){i.itemsContainer.find("img").each(function(){if(e(this).data("original_width")==undefined||r.forcedImageWidth>0){e(this).data("original_width",e(this).width())}if(e(this).data("original_height")==undefined||r.forcedImageHeight>0){e(this).data("original_height",e(this).height())}})}function f(){if(r.forcedImageWidth&&r.forcedImageHeight){i.itemsContainer.find("img").each(function(){e(this).width(r.forcedImageWidth);e(this).height(r.forcedImageHeight)})}}function l(){var e=i.itemsContainer.find("img:first");i.calculations[0]={distance:0,offset:0,opacity:1};var t=r.horizonOffset;var n=r.separation;for(var s=1;s<=r.flankingItems+2;s++){if(s>1){t*=r.horizonOffsetMultiplier;n*=r.separationMultiplier}i.calculations[s]={distance:i.calculations[s-1].distance+n,offset:i.calculations[s-1].offset+t,opacity:i.calculations[s-1].opacity*r.opacityMultiplier}}if(r.edgeFadeEnabled){i.calculations[r.flankingItems+1].opacity=0}else{i.calculations[r.flankingItems+1]={distance:0,offset:0,opacity:0}}}function c(){i.items=i.itemsContainer.find("img");for(var t=0;t<i.totalItems;t++){i.items[t]=e(i.items[t])}if(r.horizon===0){if(r.orientation==="horizontal"){r.horizon=i.containerHeight/2}else{r.horizon=i.containerWidth/2}}i.itemsContainer.css("position","relative").find("img").each(function(){var t,n;if(r.orientation==="horizontal"){t=i.containerWidth/2-e(this).data("original_width")/2;n=r.horizon-e(this).data("original_height")/2}else{t=r.horizon-e(this).data("original_width")/2;n=i.containerHeight/2-e(this).data("original_height")/2}e(this).css({left:t,top:n,visibility:"visible",position:"absolute","z-index":0,opacity:0}).data({top:n,left:t,oldPosition:0,currentPosition:0,depth:0,opacity:0}).show()})}function h(){r.startingItem=r.startingItem===0?Math.round(i.totalItems/2):r.startingItem;i.rightItemsCount=Math.ceil((i.totalItems-1)/2);i.leftItemsCount=Math.floor((i.totalItems-1)/2);i.carouselRotationsLeft=1;d(i.items[r.startingItem-1],0);i.items[r.startingItem-1].css("opacity",1);var e=r.startingItem-1;for(var t=1;t<=i.rightItemsCount;t++){e<i.totalItems-1?e+=1:e=0;i.items[e].css("opacity",1);d(i.items[e],t)}var e=r.startingItem-1;for(var t=-1;t>=i.leftItemsCount*-1;t--){e>0?e-=1:e=i.totalItems-1;i.items[e].css("opacity",1);d(i.items[e],t)}}function p(e,t){var n=Math.abs(t);if(n<r.flankingItems+1){var s=i.calculations[n]}else{var s=i.calculations[r.flankingItems+1]}var o=Math.pow(r.sizeMultiplier,n);var u=o*e.data("original_width");var a=o*e.data("original_height");var f=Math.abs(e.width()-u);var l=Math.abs(e.height()-a);var c=s.offset;var h=s.distance;if(t<0){h*=-1}if(r.orientation=="horizontal"){var p=i.containerWidth/2;var d=p+h-u/2;var v=r.horizon-c-a/2}else{var p=i.containerHeight/2;var d=r.horizon-c-u/2;var v=p+h-a/2}var m;if(t===0){m=1}else{m=s.opacity}var g=r.flankingItems+2-n;e.data("width",u);e.data("height",a);e.data("top",v);e.data("left",d);e.data("oldPosition",e.data("currentPosition"));e.data("depth",g);e.data("opacity",m)}function d(e,t){if(Math.abs(t)<=r.flankingItems+1){p(e,t);i.itemsAnimating++;e.css("z-index",e.data().depth).animate({left:e.data().left,width:e.data().width,height:e.data().height,top:e.data().top,opacity:e.data().opacity},i.currentSpeed,r.animationEasing,function(){v(e,t)})}else{e.data("currentPosition",t);if(e.data("oldPosition")===0){e.css({left:e.data().left,width:e.data().width,height:e.data().height,top:e.data().top,opacity:e.data().opacity,"z-index":e.data().depth})}}}function v(e,t){i.itemsAnimating--;e.data("currentPosition",t);if(t===0){i.currentCenterItem=e}if(i.itemsAnimating===0){i.carouselRotationsLeft-=1;i.currentlyMoving=false;if(i.carouselRotationsLeft>0){m(0)}else{i.currentSpeed=r.speed;i.currentCenterItem.addClass(r.activeClassName);if(i.performingSetup===false){r.movedToCenter(i.currentCenterItem);r.movedFromCenter(i.previousCenterItem)}i.performingSetup=false;o()}}}function m(t){if(i.currentlyMoving===false){i.currentCenterItem.removeClass(r.activeClassName);i.currentlyMoving=true;i.itemsAnimating=0;i.carouselRotationsLeft+=t;if(r.quickerForFurther===true){if(t>1){i.currentSpeed=r.speed/t}i.currentSpeed=i.currentSpeed<100?100:i.currentSpeed}for(var n=0;n<i.totalItems;n++){var s=e(i.items[n]);var o=s.data("currentPosition");var u;if(i.currentDirection=="forward"){u=o-1}else{u=o+1}var a=u>0?i.rightItemsCount:i.leftItemsCount;if(Math.abs(u)>a){u=o*-1;if(i.totalItems%2==0){u+=1}}d(s,u)}}}function g(){var e=i.currentCenterItem.next();if(e.length<=0){e=i.currentCenterItem.parent().children().first()}return e}function y(){var e=i.currentCenterItem.prev();if(e.length<=0){e=i.currentCenterItem.parent().children().last()}return e}function b(e){if(i.currentlyMoving===false){i.previousCenterItem=i.currentCenterItem;r.movingFromCenter(i.currentCenterItem);if(e=="backward"){r.movingToCenter(y());i.currentDirection="backward"}else if(e=="forward"){r.movingToCenter(g());i.currentDirection="forward"}}m(1)}if(this.length>1){this.each(function(){e(this).waterwheelCarousel(t)});return this}var n=this;var r={};var i={};e(this).find("img").bind("click",function(){var t=e(this).data().currentPosition;if(r.imageNav==false){return}if(Math.abs(t)>=r.flankingItems+1){return}if(i.currentlyMoving){return}i.previousCenterItem=i.currentCenterItem;o(true);r.autoPlay=0;var n=Math.abs(t);if(t==0){r.clickedCenter(e(this))}else{r.movingFromCenter(i.currentCenterItem);r.movingToCenter(e(this));if(t<0){i.currentDirection="backward";m(n)}else if(t>0){i.currentDirection="forward";m(n)}}});e(this).find("a").bind("click",function(t){var n=e(this).find("img").data("currentPosition")==0;if(r.linkHandling===1||r.linkHandling===2&&!n){t.preventDefault();return false}});e(document).keydown(function(e){if(r.keyboardNav){if(e.which===37&&r.orientation=="horizontal"||e.which===38&&r.orientation=="vertical"){o(true);r.autoPlay=0;b("backward")}else if(e.which===39&&r.orientation=="horizontal"||e.which===40&&r.orientation=="vertical"){o(true);r.autoPlay=0;b("forward")}if(r.keyboardNavOverride&&(r.orientation=="horizontal"&&(e.which===37||e.which===39)||r.orientation=="vertical"&&(e.which===38||e.which===40))){e.preventDefault();return false}}});this.reload=function(t){if(typeof t==="object"){var n=t}else{var n={}}r=e.extend({},e.fn.waterwheelCarousel.defaults,t);s();i.itemsContainer.find("img").hide();f();u(function(){a();l();c();h()})};this.next=function(){o(true);r.autoPlay=0;b("forward")};this.prev=function(){o(true);r.autoPlay=0;b("backward")};this.reload(t);return this};e.fn.waterwheelCarousel.defaults={startingItem:1,separation:175,separationMultiplier:.6,horizonOffset:0,horizonOffsetMultiplier:1,sizeMultiplier:.7,opacityMultiplier:.8,horizon:0,flankingItems:3,speed:300,animationEasing:"linear",quickerForFurther:true,edgeFadeEnabled:false,linkHandling:2,autoPlay:0,orientation:"horizontal",activeClassName:"carousel-center",keyboardNav:false,keyboardNavOverride:true,imageNav:true,preloadImages:true,forcedImageWidth:0,forcedImageHeight:0,movingToCenter:e.noop,movedToCenter:e.noop,clickedCenter:e.noop,movingFromCenter:e.noop,movedFromCenter:e.noop}})(jQuery)